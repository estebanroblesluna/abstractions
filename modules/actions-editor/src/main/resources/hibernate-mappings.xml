<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC 
 "-//Hibernate/Hibernate Mapping DTD//EN"
 "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping default-access="field">

  <class name="com.abstractions.model.Application" table="application">
    <id name="id" type="long" column="application_id" access="field">
      <generator class="native" />
    </id>

    <property name="name" type="string" />
    <many-to-one name="team" column="team_id" />

    <bag name="properties" lazy="true" access="field">
      <key column="application_id" />
      <one-to-many class="com.abstractions.model.Property" />
    </bag>
    <bag name="snapshots" lazy="true" access="field">
      <key column="application_id" />
      <one-to-many class="com.abstractions.model.ApplicationSnapshot" />
    </bag>
    <bag name="deploys" lazy="true" access="field">
      <key column="application_id" />
      <one-to-many class="com.abstractions.model.Deployment" />
    </bag>
  </class>

  <class name="com.abstractions.model.ApplicationSnapshot" table="application_snapshot">
    <id name="id" type="long" column="application_snapshot_id" access="field">
      <generator class="native" />
    </id>

    <property name="date" type="java.util.Date" />
    <bag name="properties" lazy="true" access="field">
      <key column="application_id" />
      <one-to-many class="com.abstractions.model.Property" />
    </bag>
  </class>


  <class name="com.abstractions.model.Deployment" table="deployment">
    <id name="id" type="long" column="deployment_id" access="field">
      <generator class="native" />
    </id>

    <many-to-one name="triggerBy" column="trigger_by_user_id" access="field" />
    <many-to-one name="snapshot" column="application_snapshot_id" access="field" />

    <bag name="servers" table="deployment_server" lazy="true" fetch="select">
      <key>
        <column name="deployment_id" not-null="true" />
      </key>
      <many-to-many entity-name="com.abstractions.model.Server">
        <column name="server_id" not-null="true" />
      </many-to-many>
    </bag>
  </class>


  <class name="com.abstractions.model.Property" table="property">
    <id name="id" type="long" column="property_id" access="field">
      <generator class="native" />
    </id>
    <property name="name" type="string" />
    <property name="value" type="string" />
    <property name="environment" />
  </class>


  <class name="com.abstractions.model.Server" table="server">
    <id name="id" type="long" column="server_id" access="field">
      <generator class="native" />
    </id>
    <property name="name" type="string" />
    <property name="ipDNS" type="string" />
  </class>


  <class name="com.abstractions.model.ServerGroup" table="server_group">
    <id name="id" type="long" column="server_group_id" access="field">
      <generator class="native" />
    </id>
    <property name="name" type="string" access="field" />
    <property name="environment" />

    <bag name="servers" lazy="true" access="field">
      <key column="server_group_id" />
      <one-to-many class="com.abstractions.model.Server" />
    </bag>
  </class>


  <class name="com.abstractions.model.Team" table="team">
    <id name="id" type="long" column="team_id" access="field">
      <generator class="native" />
    </id>
    <property name="name" type="string" access="field" />
    <many-to-one name="owner" column="owner_id" />
    <bag name="applications" lazy="true" access="field">
      <key column="team_id" />
      <one-to-many class="com.abstractions.model.Application" />
    </bag>
    <bag name="serverGroups" lazy="true" access="field">
      <key column="team_id" />
      <one-to-many class="com.abstractions.model.ServerGroup" />
    </bag>
    <bag name="users" table="user_team" inverse="false" lazy="true" fetch="select" cascade="all" access="field">
      <key column="team_id" />
      <many-to-many class="com.abstractions.model.User" column="user_id" />
    </bag>
  </class>


  <class name="com.abstractions.model.User" table="user">
    <id name="id" type="long" column="user_id" access="field">
      <generator class="native" />
    </id>
    <property name="firstName" column="first_name" type="string" />
    <property name="lastName" column="last_name" type="string" />

    <bag name="teams" table="user_team" inverse="true" lazy="false" fetch="select" cascade="all" access="field">
      <key column="user_id" />
      <many-to-many class="com.abstractions.model.Team" column="team_id" />
    </bag>
  </class>

</hibernate-mapping>