<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC 
 "-//Hibernate/Hibernate Mapping DTD//EN"
 "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping>

  <class name="com.abstractions.model.Application" table="application">
    <id name="id" type="long" column="application_id" access="field">
      <generator class="native" />
    </id>

    <property name="name" type="string" />

    <bag name="builtByUsers" lazy="true" access="field">
      <key column="application_id" />
      <one-to-many class="com.abstractions.model.User" />
    </bag>
    <bag name="builds" table="application_build" inverse="false" lazy="true" fetch="select" cascade="all" access="field">
      <key>
        <column name="application_id" not-null="true" />
      </key>
      <many-to-many entity-name="com.abstractions.model.Build">
        <column name="build_id" not-null="true" />
      </many-to-many>
    </bag>
    <bag name="deploys" lazy="true" access="field">
      <key column="application_id" />
      <one-to-many class="com.abstractions.model.Deployment" />
    </bag>
  </class>


  <class name="com.abstractions.model.ApplicationSnapshot" table="application_snapshot">
    <id name="id" type="long" column="application_snapshot_id" access="field">
      <generator class="native" />
    </id>
  </class>


  <class name="com.abstractions.model.Build" table="build">
    <id name="id" type="long" column="build_id" access="field">
      <generator class="native" />
    </id>

    <property name="date" type="string"  access="field"/>
    <many-to-one name="application" column="application_id"  access="field"/>
    <many-to-one name="snapshot" column="application_snapshot_id"  access="field"/>

    <bag name="properties" lazy="true" access="field">
      <key column="build_id" />
      <one-to-many class="com.abstractions.model.Property" />
    </bag>
  </class>


  <class name="com.abstractions.model.Deployment" table="deployment">
    <id name="id" type="long" column="deployment_id" access="field">
      <generator class="native" />
    </id>

    <many-to-one name="triggerBy" column="trigger_by_user_id"  access="field"/>
    <many-to-one name="build" column="build_id"  access="field"/>

    <bag name="servers" lazy="true" access="field">
      <key column="deployment_id" />
      <one-to-many class="com.abstractions.model.Server" />
    </bag>
  </class>

  
  <class name="com.abstractions.model.Property" table="property">
    <id name="id" type="long" column="property_id" access="field">
      <generator class="native" />
    </id>
    <property name="name" type="string" />
    <property name="value" type="string" />
    <property name="environment" />
  </class>  

    
  <class name="com.abstractions.model.Server" table="server">
    <id name="id" type="long" column="server_id" access="field">
      <generator class="native" />
    </id>
    <property name="name" type="string" />
    <property name="ipDNS" type="string" />
    <many-to-one name="group" column="server_group_id" />
  </class>


  <class name="com.abstractions.model.ServerGroup" table="server_group">
    <id name="id" type="long" column="server_group_id" access="field">
      <generator class="native" />
    </id>
    <property name="name" type="string" access="field"/>
  </class>
    
  
  <class name="com.abstractions.model.User" table="user">
    <id name="id" type="long" column="user_id" access="field">
      <generator class="native" />
    </id>
    <property name="firstName" column="first_name" type="string" />
    <property name="lastName" column="last_name" type="string" />
  </class>

</hibernate-mapping>